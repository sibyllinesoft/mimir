{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://mimir.dev/schemas/symbol_entry.json",
  "title": "Symbol Entry",
  "description": "Individual symbol entry in the Serena graph",
  "type": "object",
  "required": ["type", "path", "span"],
  "properties": {
    "type": {
      "type": "string",
      "enum": ["def", "ref", "call", "import"],
      "description": "Type of symbol entry"
    },
    "symbol": {
      "type": ["string", "null"],
      "description": "Fully qualified symbol name"
    },
    "path": {
      "type": "string",
      "description": "Source file path relative to repository root"
    },
    "span": {
      "type": "array",
      "items": {
        "type": "integer",
        "minimum": 0
      },
      "minItems": 2,
      "maxItems": 2,
      "description": "Byte offset range [start, end)"
    },
    "sig": {
      "type": ["string", "null"],
      "description": "Type signature for definitions"
    },
    "caller": {
      "type": ["string", "null"],
      "description": "Calling symbol for call entries"
    },
    "callee": {
      "type": ["string", "null"],
      "description": "Called symbol for call entries"
    },
    "from_module": {
      "type": ["string", "null"],
      "description": "Import source for import entries"
    }
  },
  "allOf": [
    {
      "if": {
        "properties": {
          "type": { "const": "def" }
        }
      },
      "then": {
        "required": ["symbol"]
      }
    },
    {
      "if": {
        "properties": {
          "type": { "const": "call" }
        }
      },
      "then": {
        "required": ["caller", "callee"]
      }
    },
    {
      "if": {
        "properties": {
          "type": { "const": "import" }
        }
      },
      "then": {
        "required": ["from_module"]
      }
    }
  ]
}